<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CTrace GUI</title>
  <link rel="icon" href="../assets/ctrace.ico">
  
  <!-- Modular CSS imports -->
  <link rel="stylesheet" href="styles/base.css">
  <link rel="stylesheet" href="styles/activity-bar.css">
  <link rel="stylesheet" href="styles/sidebar.css">
  <link rel="stylesheet" href="styles/menubar.css">
  <link rel="stylesheet" href="styles/tabs.css">
  <link rel="stylesheet" href="styles/editor.css">
  <link rel="stylesheet" href="styles/welcome.css">
  <link rel="stylesheet" href="styles/search.css">
  <link rel="stylesheet" href="styles/dialogs.css">
  <link rel="stylesheet" href="styles/statusbar.css">
  <link rel="stylesheet" href="styles/tools-panel.css">
  <link rel="stylesheet" href="styles/visualyzer.css">
  <link rel="stylesheet" href="styles/resizers.css">
  <link rel="stylesheet" href="styles/titlebar.css">
  
  <!-- Font loading for cross-platform emoji support -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Color+Emoji&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Segoe+UI+Emoji&display=swap');
    
    /* Fallback emoji font stack for cross-platform support */
    .emoji-font {
      font-family: 'Noto Color Emoji', 'Segoe UI Emoji', 'Apple Color Emoji', 'Twemoji Mozilla', system-ui, sans-serif;
    }
    
    /* Apply emoji fonts globally */
    body, * {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Noto Color Emoji', 'Segoe UI Emoji', 'Apple Color Emoji';
    }
  </style>
  
  <!-- Make ipcRenderer available globally -->
  <script>
    const { ipcRenderer } = require('electron');
    window.ipcRenderer = ipcRenderer;
  </script>
  
  <!-- Load modular JavaScript -->
  <script>
    // Since we're in a renderer process, we need to handle module loading differently
    // We'll load the UIController which will handle everything
    const UIController = require('./renderer/UIController');
    
    // Load syntax highlighter utility
    const syntaxHighlighter = require('./renderer/utils/syntaxHighlighter');
    window.syntaxHighlighter = syntaxHighlighter;
  </script>
  
  <!-- D3.js for interactive graph visualization -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
  <!-- Custom Title Bar -->
  <div class="title-bar">
    <div class="title-bar-drag-region">
      <div class="title-bar-title">
        <img src="../assets/ctrace.png" alt="CTrace" class="title-bar-icon">
        <span>CTrace GUI</span>
      </div>
    </div>
    <div class="title-bar-controls">
      <button class="title-bar-control" id="minimize-btn" title="Minimize">
        <svg width="10" height="10" viewBox="0 0 10 10">
          <path d="M0,5 L10,5" stroke="currentColor" stroke-width="1"/>
        </svg>
      </button>
      <button class="title-bar-control" id="maximize-btn" title="Maximize">
        <svg width="10" height="10" viewBox="0 0 10 10">
          <path d="M0,0 L10,0 L10,10 L0,10 Z" stroke="currentColor" stroke-width="1" fill="none"/>
        </svg>
      </button>
      <button class="title-bar-control close" id="close-btn" title="Close">
        <svg width="10" height="10" viewBox="0 0 10 10">
          <path d="M0,0 L10,10 M10,0 L0,10" stroke="currentColor" stroke-width="1"/>
        </svg>
      </button>
    </div>
  </div>
  
  <div class="ide-container">
    <!-- Main Content Area (Left Side) -->
    <div class="main-content-area">
      <!-- Activity Bar (Left) -->
      <div class="activity-bar">
      <div class="activity-item active" id="explorer-activity" title="Explorer" onclick="showExplorer()">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
          <path d="M14.5 3h-13a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h13a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z"/>
        </svg>
      </div>
      <div class="activity-item" id="search-activity" title="Search" onclick="showSearch()">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
          <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
        </svg>
      </div>
      <!-- <div class="activity-item" title="Extensions" onclick="showExtensions()">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
          <path d="M8.5 1a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13zM0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8z"/>
        </svg>
      </div> -->
    </div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="resizer resizer-right" onmousedown="initSidebarResize(event)"></div>
      <div class="sidebar-header">
        <div style="display: flex; align-items: center; gap: 8px;">
          <svg width="12" height="12" viewBox="0 0 16 16" fill="currentColor">
            <path d="M1.5 3a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1h-13zm0 5a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1h-13zm0 5a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1h-13z"/>
          </svg>
          <span id="sidebar-title">Explorer</span>
        </div>
      </div>
      <div class="sidebar-content">
        <div id="explorer-view">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
            <div style="color: #7d8590; font-size: 11px; font-weight: 600;">WORKSPACE</div>
            <button id="refresh-file-tree" title="Refresh" style="background: none; border: none; cursor: pointer; padding: 2px;">
              <svg width="12" height="12" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 1 1 .908-.418A4 4 0 1 0 8 4V1.5a.5.5 0 0 1 1 0v3A.5.5 0 0 1 8.5 5h-3a.5.5 0 0 1 0-1H8z"/>
              </svg>
            </button>
          </div>
          <div id="workspace-folder" style="display: none;">
            <div style="color: #7d8590; font-size: 11px; margin-bottom: 8px; font-weight: 600;" id="workspace-name"></div>
            <div id="file-tree" class="file-tree"></div>
          </div>
          <div id="no-workspace">
            <div style="padding: 8px 12px; background: #21262d; border-radius: 6px; cursor: pointer; margin-bottom: 8px; transition: all 0.15s ease;" onclick="openWorkspace()">
              <div style="font-size: 12px; font-weight: 500;">üìÅ Open Folder</div>
              <div style="font-size: 10px; color: #7d8590; margin-top: 2px;">Open a workspace or folder</div>
            </div>
          </div>
        </div>
        <div id="search-view" style="display: none;">
          <div class="search-panel">
            <input type="text" id="sidebar-search-input" class="search-input" placeholder="Search in files..." />
            <div id="search-results" class="search-results"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Editor Area -->
    <div class="main">
      <!-- Menu Bar -->
      <div class="menubar">
        <div class="menu-item" id="file-menu" onclick="toggleMenu('file-menu')">
          File
          <div class="dropdown-menu" id="file-dropdown">
            <div class="dropdown-item" onclick="createNewFile(); hideAllMenus();">
              <span>New File</span>
              <span class="shortcut">Ctrl+N</span>
            </div>
            <div class="dropdown-separator"></div>
            <div class="dropdown-item" onclick="openFile(); hideAllMenus();">
              <span>Open File...</span>
              <span class="shortcut">Ctrl+O</span>
            </div>
            <div class="dropdown-item" onclick="openWorkspace(); hideAllMenus();">
              <span>Open Folder...</span>
              <span class="shortcut">Ctrl+Shift+O</span>
            </div>
            <div class="dropdown-separator"></div>
            <div class="dropdown-item" onclick="saveFile(); hideAllMenus();">
              <span>Save</span>
              <span class="shortcut">Ctrl+S</span>
            </div>
            <div class="dropdown-item" onclick="autoSave(); hideAllMenus();">
              <span>Auto Save</span>
            </div>
            <div class="dropdown-item" onclick="saveAsFile(); hideAllMenus();">
              <span>Save As...</span>
              <span class="shortcut">Ctrl+Shift+S</span>
            </div>
            <div class="dropdown-separator"></div>
            <div class="dropdown-item" onclick="closeCurrentTab(); hideAllMenus();">
              <span>Close File</span>
              <span class="shortcut">Ctrl+W</span>
            </div>
          </div>
        </div>
        
        <div class="menu-item" id="edit-menu" onclick="toggleMenu('edit-menu')">
          Edit
          <div class="dropdown-menu" id="edit-dropdown">
            <div class="dropdown-item" onclick="showFindDialog(); hideAllMenus();">
              <span>Find</span>
              <span class="shortcut">Ctrl+F</span>
            </div>
            <div class="dropdown-separator"></div>
            <div class="dropdown-item" onclick="formatCode(); hideAllMenus();">
              <span>Format Document</span>
              <span class="shortcut">Shift+Alt+F</span>
            </div>
            <div class="dropdown-item" onclick="toggleWordWrap(); hideAllMenus();">
              <span>Toggle Word Wrap</span>
              <span class="shortcut">Alt+Z</span>
            </div>
            <div class="dropdown-separator"></div>
            <div class="dropdown-item" onclick="showGoToLineDialog(); hideAllMenus();">
              <span>Go to Line...</span>
              <span class="shortcut">Ctrl+G</span>
            </div>
          </div>
        </div>
        
        <div class="menu-item" id="view-menu" onclick="toggleMenu('view-menu')">
          View
          <div class="dropdown-menu" id="view-dropdown">
            <div class="dropdown-item" onclick="showExplorer(); hideAllMenus();">
              <span>Explorer</span>
              <span class="shortcut">Ctrl+Shift+E</span>
            </div>
            <div class="dropdown-item" onclick="showSearch(); hideAllMenus();">
              <span>Search</span>
              <span class="shortcut">Ctrl+Shift+F</span>
            </div>
            <div class="dropdown-separator"></div>
            <div class="dropdown-item" onclick="toggleSidebar(); hideAllMenus();">
              <span>Toggle Sidebar</span>
              <span class="shortcut">Ctrl+B</span>
            </div>
          </div>
        </div>
        
        <div class="menu-item" onclick="toggleToolsPanel(); hideAllMenus();">
          Ctrace Tools
        </div>

        <div class="menu-item" onclick="openAssistantPanel(); hideAllMenus();">
          Assistant
        </div>
        
        <div class="menu-item" onclick="toggleVisualyzerPanel(); hideAllMenus();">
          Visualyzer
        </div>
      </div>
        
      <!-- Tabs -->
      <div class="tabs-container" id="tabs-container" style="display: none;">
        <!-- Tabs will be added dynamically -->
      </div>

      <!-- Editor Container -->
      <div class="editor-container">
        <!-- VS Code Style Search Widget -->
        <div id="search-widget" class="search-widget">
          <div class="search-input-container">
            <input type="text" id="widget-search-input" class="search-input" placeholder="Find" />
            <button class="search-close" onclick="closeSearchWidget()">√ó</button>
          </div>
          <div class="search-results">
            <span id="search-results-text">No results</span>
            <div class="search-navigation">
              <button class="search-nav-btn" id="search-prev" onclick="searchPrev()" disabled>‚Üë</button>
              <button class="search-nav-btn" id="search-next" onclick="searchNext()" disabled>‚Üì</button>
            </div>
          </div>
        </div>

        <div class="goto-dialog" id="goto-dialog">
          <div class="goto-header">
            <span>Go to Line</span>
            <button class="goto-close" onclick="closeGoToLineDialog()">√ó</button>
          </div>
          <input type="number" id="goto-input" class="goto-input" placeholder="Line number (e.g. 42)" min="1" />
          <div class="goto-buttons">
            <button class="goto-btn primary" onclick="performGoToLine()">Go</button>
          </div>
        </div>

        <div class="editor-main">
          <!-- Welcome Screen (shown by default) -->
          <div class="welcome-screen" id="welcome-screen">
            <h1>Welcome to CTraceGUI</h1>
            <p>Import a file to start analysis!</p>
            <div class="welcome-actions">
              <button class="welcome-action" onclick="createNewFile()">
                üìù New File
              </button>
              <button class="welcome-action" onclick="openFile()">
                üìÑ Open File
              </button>
              <button class="welcome-action" onclick="openWorkspace()">
                üìÅ Open Folder
              </button>
            </div>
            <p style="font-size: 14px; color: #6e7681; margin-top: 24px;">
              You can also use the <strong>File</strong> menu above to access all file operations.
            </p>
          </div>
          
          <!-- Editor Area (hidden by default) -->
          <div style="display: none;" id="editor-area">
            <div class="gutter" id="gutter">1</div>
            <div class="editor" id="editor" contenteditable="true" spellcheck="false" data-placeholder="Start typing your code here..."></div>
          </div>
          
          <!-- Visualyzer Area (hidden by default) -->
          <div class="visualyzer-area" id="visualyzer-area" style="display: none;">
            <div id="visualyzer-dropzone" class="visualyzer-dropzone">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
              <p>Drag & Drop .dot file here</p>
              <p style="font-size: 11px; color: #7d8590;">or click to browse</p>
              <input type="file" id="visualyzer-file-input" accept=".dot,.gv" style="display: none;">
            </div>
            
            <div id="visualyzer-controls" class="visualyzer-controls" style="display: none;">
              <button class="viz-btn" onclick="visualyzerZoomIn()" title="Zoom In">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                </svg>
              </button>
              <button class="viz-btn" onclick="visualyzerZoomOut()" title="Zoom Out">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8z"/>
                </svg>
              </button>
              <button class="viz-btn" onclick="visualyzerResetZoom()" title="Reset View">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 1 1 .908-.418A4 4 0 1 0 8 4v3.5a.5.5 0 0 1-1 0v-5a.5.5 0 0 1 .5-.5z"/>
                </svg>
              </button>
              <button class="viz-btn" onclick="visualyzerClear()" title="Clear Graph">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                </svg>
              </button>
              <button class="viz-btn" onclick="closeVisualyzer()" title="Close Visualyzer">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                  <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                </svg>
              </button>
            </div>
            
            <div id="visualyzer-canvas" class="visualyzer-canvas">
              <!-- SVG graph will be rendered here -->
            </div>
            
            <div id="visualyzer-info" class="visualyzer-info" style="display: none;">
              <span id="visualyzer-filename"></span>
              <span id="visualyzer-stats"></span>
            </div>
          </div>
        </div>
      </div>

      <!-- Status Bar -->
      <div class="statusbar">
        <div class="statusbar-left">
          <span id="lineCounter">Ln 1, Col 1</span>
          <span id="fileStatus">UTF-8</span>
          <span id="fileType">Plain Text</span>
        </div>
        <div class="statusbar-right">
          <span id="tool_version">CTraceGUI v0.1.0</span>
        </div>
      </div>
    </div>
    </div> <!-- End main-content-area -->

    <!-- Ctrace Tools Panel (Right Side) -->
    <div class="tools-panel" id="toolsPanel">
      <div class="resizer resizer-left" onmousedown="initToolsPanelResize(event)"></div>
      <div class="tools-panel-header">
        <span>Ctrace Tools</span>
        <button class="close-btn" onclick="hideToolsPanel()" title="Close Panel">√ó</button>
      </div>
      <div class="tools-panel-content">
        <div style="margin-bottom: 20px;">
          <h3 style="margin: 0 0 12px 0; font-size: 14px; color: #f0f6fc;">Quick Actions</h3>
          <div style="display: flex; flex-direction: column; gap: 8px;">
            <button style="background: #1f6feb; border: none; color: white; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; transition: all 0.15s ease;" onclick="runCTrace()">
              ‚ñ∂ Run CTrace
            </button>
          </div>
        </div>

        <div style="margin-bottom: 20px;">
          <h3 style="margin: 0 0 12px 0; font-size: 14px; color: #f0f6fc;">CTrace Output</h3>
          <div style="display: flex; gap: 8px; margin-bottom: 8px;">
            <button style="background: #21262d; border: 1px solid #30363d; color: #f0f6fc; padding: 4px 8px; border-radius: 6px; cursor: pointer; font-size: 11px;" onclick="clearCTraceOutput()">Clear</button>
            <button style="background: #21262d; border: 1px solid #30363d; color: #f0f6fc; padding: 4px 8px; border-radius: 6px; cursor: pointer; font-size: 11px;" onclick="copyCTraceOutput()">Copy</button>
          </div>
          <pre id="ctrace-output" style="background: #0d1117; border: 1px solid #30363d; border-radius: 6px; padding: 12px; color: #f0f6fc; font-family: 'JetBrains Mono', 'Fira Code', monospace; font-size: 12px; line-height: 1.5; height: 320px; max-height: 65vh; overflow: auto; white-space: pre-wrap;">Waiting to run...</pre>
        </div>

        <div>
          <!-- <h3 style="margin: 0 0 12px 0; font-size: 14px; color: #f0f6fc;">Extensions</h3> -->
        </div>
      </div>
    </div>
  </div>


</body>
</html>
